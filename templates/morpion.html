<!-- templates/morpion.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morpion Game</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <style>
        table {
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <h1>Morpion Game</h1>
    <button id="start-game-button" disabled>Start Game</button>

    <div id="game-info">
        <p id="player-count"></p>
        <p id="player-symbol"></p>
    </div>

    <div id="game-board">
        <table id="morpion-table">
            <tr>
                <td data-row="0" data-col="0"></td>
                <td data-row="0" data-col="1"></td>
                <td data-row="0" data-col="2"></td>
            </tr>
            <tr>
                <td data-row="1" data-col="0"></td>
                <td data-row="1" data-col="1"></td>
                <td data-row="1" data-col="2"></td>
            </tr>
            <tr>
                <td data-row="2" data-col="0"></td>
                <td data-row="2" data-col="1"></td>
                <td data-row="2" data-col="2"></td>
            </tr>
        </table>
    </div>

    <script>
        // Connect to the Socket.IO server
        const socket = io();
        const urlParams = new URLSearchParams(window.location.search);
        const roomName = urlParams.get('room');
        let playerSymbol = '';

        // Join the room
        socket.emit('join_room', { room: roomName });

        // Add event listener to the start game button
        document.getElementById('start-game-button').addEventListener('click', () => {
            socket.emit('start_game', { room: roomName });
        });

        // Listen for game started event
        socket.on('game_started', (data) => {
            alert(data.message);
            // Reset the game board
            document.querySelectorAll('#morpion-table td').forEach(cell => {
                cell.textContent = '';
            });
        });

        // Listen for game state updates
        socket.on('update_state', (gameState) => {
            // Update the game board with the new state
            gameState.board.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const cellElement = document.querySelector(`#morpion-table td[data-row="${rowIndex}"][data-col="${colIndex}"]`);
                    cellElement.textContent = cell;
                });
            });
        });

        // Enable start game button when successfully joined a room
        socket.on('room_joined', (data) => {
            document.getElementById('start-game-button').disabled = false;
            document.getElementById('player-count').textContent = `Players in room: ${data.playerCount}`;
            document.getElementById('player-symbol').textContent = `You are playing as: ${data.symbol}`;
            playerSymbol = data.symbol;
        });

        // Listen for update in player count
        socket.on('update_player_count', (data) => {
            document.getElementById('player-count').textContent = `Players in room: ${data.playerCount}`;
        });

        // Handle cell clicks for making moves
        document.querySelectorAll('#morpion-table td').forEach(cell => {
            cell.addEventListener('click', () => {
                const row = cell.getAttribute('data-row');
                const col = cell.getAttribute('data-col');
                socket.emit('make_move', { room: roomName, row: parseInt(row), col: parseInt(col), player: playerSymbol });
            });
        });

        // Handle errors
        socket.on('error', (error) => {
            alert(error.message);
        });
    </script>
</body>
</html>
